<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }
        #container {
            display: flex;
            flex-direction: row;
        }
        #buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        #buttons button {
            font-size: 1.6em; /* 2emの0.8倍 */
            padding: 32px; /* 40pxの0.8倍 */
        }
        #display {
            text-align: right;
            margin-bottom: 20px;
            width: calc(2 * (4 * 32px + 3 * 10px)); /* ボタンの横幅の2倍に合わせる */
            max-width: 100%;
        }
        #log {
            margin-left: 20px;
            width: calc(4 * 32px + 3 * 10px); /* ボタン4つ分の横幅に合わせる */
            max-width: 100%;
            text-align: left;
            border: 1px solid #000; /* 枠線を追加 */
            padding: 10px; /* 内側の余白を追加 */
            border-radius: 5px; /* 角を丸くする */
        }
    </style>
    <title>計算機</title>
</head>
<body>

<h1>シンプルな計算機</h1>

<div id="container">
    <div>
        <input id="display" type="text" readonly>
        <br>
        <div id="buttons">
            <button onclick="appendNumber(7)">7</button>
            <button onclick="appendNumber(8)">8</button>
            <button onclick="appendNumber(9)">9</button>
            <button onclick="setOperator('+')">+</button>
            <button onclick="appendNumber(4)">4</button>
            <button onclick="appendNumber(5)">5</button>
            <button onclick="appendNumber(6)">6</button>
            <button onclick="setOperator('-')">-</button>
            <button onclick="appendNumber(1)">1</button>
            <button onclick="appendNumber(2)">2</button>
            <button onclick="appendNumber(3)">3</button>
            <button onclick="setOperator('*')">*</button>
            <button onclick="clearDisplay()">C</button>
            <button onclick="appendNumber(0)">0</button>
            <button onclick="calculate()">=</button>
            <button onclick="setOperator('/')">/</button>
            <button onclick="calculateFactorial()">!</button>
            <button onclick="setOperator('^')">^</button>
            <button onclick="calculateSquareRoot()">√</button>
        </div>
    </div>
    <div id="log"></div>
</div>

<a href="workshop1.html">ワークショップに戻る</a>

<script>
let operand1 = '';
let operand2 = '';
let operator = null;
let resultDisplayed = false;

function appendNumber(number) {
    if (resultDisplayed) {
        operand1 = '';
        resultDisplayed = false;
    }
    if (operator === null) {
        operand1 += number;
    } else {
        operand2 += number;
    }
    updateDisplay();
}

function setOperator(op) {
    if (operand1 !== '') {
        operator = op;
    }
    updateDisplay();
}

function calculate() {
    let result;
    switch (operator) {
        case '+':
            result = parseInt(operand1) + parseInt(operand2);
            break;
        case '-':
            result = parseInt(operand1) - parseInt(operand2);
            break;
        case '*':
            result = parseInt(operand1) * parseInt(operand2);
            break;
        case '/':
            result = parseInt(operand1) / parseInt(operand2);
            break;
        case '^':
            result = Math.pow(parseInt(operand1), parseInt(operand2));
            break;
    }
    logCalculation(operand1, operator, operand2, result);
    operand1 = result;
    operand2 = '';
    operator = null;
    resultDisplayed = true;
    updateDisplay();
}

function clearDisplay() {
    operand1 = '';
    operand2 = '';
    operator = null;
    resultDisplayed = false;
    updateDisplay();
}

function updateDisplay() {
    let displayValue = operand1;
    if (operator !== null) {
        displayValue += operator;
    }
    if (operand2 !== '') {
        displayValue += operand2;
    }
    document.getElementById('display').value = displayValue;
}

function logCalculation(op1, operator, op2, result) {
    const logDiv = document.getElementById('log');
    const logEntry = document.createElement('div');
    logEntry.textContent = `${op1} ${operator} ${op2} = ${result}`;
    logDiv.insertBefore(logEntry, logDiv.firstChild);
}

function calculateFactorial() {
    if (operand1 !== '') {
        let result = 1;
        for (let i = 1; i <= parseInt(operand1); i++) {
            result *= i;
        }
        logCalculation(operand1, '!', '', result);
        operand1 = result;
        operand2 = '';
        operator = null;
        resultDisplayed = true;
        updateDisplay();
    }
}

function calculateSquareRoot() {
    if (operand1 !== '') {
        let result = Math.sqrt(parseInt(operand1));
        logCalculation('√', operand1, '', result);
        operand1 = result;
        operand2 = '';
        operator = null;
        resultDisplayed = true;
        updateDisplay();
    }
}
</script>

</body>
</html>
